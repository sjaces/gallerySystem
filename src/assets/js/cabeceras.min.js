/**
 * cabeceras.js
 *
 * scripts creados para la discriminación de las diferentes cabeceras online del Grupo Joly
 *
 * Angel Cachon / tellme@angelcachon.es
 *
 * version 0.4 Adaptación a no cambiar según url, ver correo 4/4/19 Javier Salcedo
 * version 0.3
 *  · soporte para autocomprobar la url primero.
 * version 0.2
 *  · Se ha añadido checkLinks(URL) la búsqueda de hiperenlaces que necesiten ser actualizados según la cabecera.
 *    para ello se usa una propiedad cabecera=""
 * version 0.1
 *
 */

function cabeceras(tipo) {
  // console.log("cabeceras", tipo);
  // console.log("doc", document.referrer);
  const TIPOSDELOGOS = tipo;
  const DIASCOOKIE = 2;
  // crearCookie("cabecera", "dc", -1)
  if (window.localStorage.getItem("referral")) decideCabecera(window.localStorage.getItem("referral"));
  crearCookie("doc", document.referrer, DIASCOOKIE);
  compruebaCabecera();
  function compruebaCabecera() {
    var e = document.referrer;
    decideCabecera(e);
    compruebaGet();
    "" != obtenerCookie("cabecera") && pintaCabecera(obtenerCookie("cabecera"));
  }

  function decideCabecera(e) {
    if (e) {
      var a = e.split("//");
      switch (((a = a[1].split("/")), (a = a[0]), a)) {
        case "www.diariodesevilla.es":
        case "m.diariodesevilla.es":
          pintaCabecera("ds");
          break;
        case "www.diariodecadiz.es":
        case "m.diariodecadiz.es":
          pintaCabecera("dc");
          break;
        case "www.diariodejerez.es":
        case "m.diariodejerez.es":
          pintaCabecera("dj");
          break;
        case "www.europasur.es":
        case "m.europasur.es":
          pintaCabecera("es");
          break;
        case "www.diariodealmeria.es":
        case "m.diariodealmeria.es":
          pintaCabecera("da");
          break;
        case "www.eldiadecordoba.es":
        case "m.eldiadecordoba.es":
          pintaCabecera("ed");
          break;
        case "www.granadahoy.com":
        case "m.granadahoy.com":
          pintaCabecera("gh");
          break;
        case "www.huelvainformacion.es":
        case "m.huelvainformacion.es":
          pintaCabecera("hi");
          break;
        case "www.malagahoy.es":
        case "m.malagahoy.es":
          pintaCabecera("mh");
      }
    }
  }

  function compruebaGet() {
    var e = getGET();
    // console.log("comprobando get", e);
    if (e && e.cabecera) {
      var a = e.cabecera.split("#")[0];
      switch (a) {
        case "ds":
        case "hi":
        case "dc":
        case "es":
        case "dj":
        case "ed":
        case "gh":
        case "mh":
        case "da":
          pintaCabecera(a);
      }
    }
  }

  function pintaCabecera(e) {
    // console.log("pintando cabecera", e);
    var a = "";
    if ("gj" != e) {
      switch ((crearCookie("cabecera", e, DIASCOOKIE), e)) {
        case "ds":
          a = "www.diariodesevilla.es";
          break;
        case "dc":
          a = "www.diariodecadiz.es";
          break;
        case "es":
          a = "www.europasur.es";
          break;
        case "dj":
          a = "www.diariodejerez.es";
          break;
        case "ed":
          a = "www.eldiadecordoba.es";
          break;
        case "gh":
          a = "www.granadahoy.com";
          break;
        case "mh":
          a = "www.malagahoy.es";
          break;
        case "da":
          a = "www.diariodealmeria.es";
          break;
        case "hi":
          a = "www.huelvainformacion.es";
      }
      window.document.getElementById("home").setAttribute("href", "https://" + a);
      let urlMancheta = `./data/manchetas/${TIPOSDELOGOS}/` + e + ".png";
      // console.log("urlmancheta", urlMancheta);
      document.getElementById("mancheta").setAttribute("src", urlMancheta);
      window.history.pushState(window.location.href.split("?")[0], "pageview", window.location.href.split("?")[0]);
      // checkLinks(a);
    }
  }

  function getGET() {
    var e = document.location.href;
    if (e.indexOf("?") > 0) {
      for (var a = e.split("?")[1], i = a.split("&"), r = {}, c = 0, o = i.length; c < o; c++) {
        var t = i[c].split("=");
        r[t[0]] = unescape(decodeURI(t[1]));
      }
      return r;
    }
  }

  function crearCookie(e, a, i) {
    var r = new Date();
    r.setTime(r.getTime() + 24 * i * 60 * 60 * 1e3);
    var c = "expires=" + r.toUTCString();
    document.cookie = e + "=" + a + "; " + c;
  }

  function obtenerCookie(e) {
    for (var a = e + "=", i = document.cookie.split(";"), r = 0; r < i.length; r++) {
      for (var c = i[r]; " " == c.charAt(0); ) c = c.substring(1);
      if (0 == c.indexOf(a)) return c.substring(a.length, c.length);
    }
    return "";
  }

  // window.onload = function() {
  //   compruebaCabecera();
  // };
}

export default cabeceras;
